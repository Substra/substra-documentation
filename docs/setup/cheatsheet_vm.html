

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Cheatsheet Ubuntu 20.04 VM &mdash; Substra 1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Further resources" href="further_resources.html" />
    <link rel="prev" title="Local installation of Substra using Kubernetes and Skaffold" href="local_install_skaffold.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Substra
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
</ul>
<p><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging.html">Local Debug</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Server setup</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="local_install_skaffold.html">Local installation of Substra using Kubernetes and Skaffold</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Cheatsheet Ubuntu 20.04 VM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#system">System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hardware-check">Hardware check</a></li>
<li class="toctree-l4"><a class="reference internal" href="#system-updates">System updates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#softwares-installation">Softwares installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#docker">Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minikube-v1-9-2">Minikube v1.9.2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kubectl-v1-16-7">Kubectl v1.16.7</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helm-v2-16-1">Helm v2.16.1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#skaffold-v1-8-0">Skaffold v1.8.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#k9s-v0-22-0">k9s v0.22.0</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#minikube-config">Minikube config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helm-init">Helm init</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-bitnami-repo-to-helm-repos">Add bitnami repo to Helm repos</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#network-quick-config">Network quick config</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#on-the-server">On the server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#on-your-local-machine-mac-linux">On your local machine (Mac &amp; Linux)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#clone-the-repositories-and-switch-to-the-correct-version">Clone the repositories and switch to the correct version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fire-up">Fire up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="further_resources.html">Further resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../demo.html">Demo</a></li>
</ul>
<p><span class="caption-text">Platform description</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
</ul>
<p><span class="caption-text">Specific entry points</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p><span class="caption-text">Contribute</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing to Substra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publish.html">Build &amp; publish the documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Substra</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Server setup</a> &raquo;</li>
        
      <li>Cheatsheet Ubuntu 20.04 VM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="cheatsheet-ubuntu-20-04-vm">
<h1>Cheatsheet Ubuntu 20.04 VM<a class="headerlink" href="#cheatsheet-ubuntu-20-04-vm" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>/!\ This setup is only compatible with Substra v.0.6.0. It will soon be updated.
Please refer to the <a class="reference external" href="https://github.com/SubstraFoundation/substra#compatibility-table">compatibility table</a> for further information.</p>
</div></blockquote>
<blockquote>
<div><p>/!\ This configuration is totally not suitable for production environment!</p>
</div></blockquote>
<section id="system">
<h2>System<a class="headerlink" href="#system" title="Permalink to this headline">¶</a></h2>
<section id="hardware-check">
<h3>Hardware check<a class="headerlink" href="#hardware-check" title="Permalink to this headline">¶</a></h3>
<p>Please check first the hardware-related information of your machine and update accordingly installation procedures. This guide aims at <code class="docutils literal notranslate"><span class="pre">x86_64</span></code> machines.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uname -mp
</pre></div>
</div>
</section>
<section id="system-updates">
<h3>System updates<a class="headerlink" href="#system-updates" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo apt upgrade -y <span class="o">&amp;&amp;</span> <span class="se">\</span>
	sudo apt autoremove --purge -y <span class="o">&amp;&amp;</span> <span class="se">\</span>
	sudo apt autoclean
</pre></div>
</div>
</section>
</section>
<section id="softwares-installation">
<h2>Softwares installation<a class="headerlink" href="#softwares-installation" title="Permalink to this headline">¶</a></h2>
<section id="docker">
<h3><a class="reference external" href="https://docs.docker.com/engine/install/ubuntu/">Docker</a><a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt-get install <span class="se">\</span>
    apt-transport-https <span class="se">\</span>
    ca-certificates <span class="se">\</span>
    curl <span class="se">\</span>
    gnupg-agent <span class="se">\</span>
    software-properties-common <span class="se">\</span>
    socat <span class="c1"># needed by k8s/skaffold in virtualized context</span>

curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -

sudo add-apt-repository <span class="se">\</span>
    <span class="s2">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span>
<span class="s2">    </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> \</span>
<span class="s2">    stable&quot;</span>

sudo apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo apt-get install docker-ce docker-ce-cli containerd.io

sudo groupadd docker
sudo usermod -aG docker <span class="nv">$USER</span>
</pre></div>
</div>
</section>
<section id="minikube-v1-9-2">
<h3><a class="reference external" href="https://minikube.sigs.k8s.io/docs/start/">Minikube v1.9.2</a><a class="headerlink" href="#minikube-v1-9-2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl -LO https://github.com/kubernetes/minikube/releases/download/v1.9.2/minikube-linux-amd64 <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo install minikube-linux-amd64 /usr/local/bin/minikube <span class="o">&amp;&amp;</span> <span class="se">\</span>
    rm -rf minikube-linux-amd64
</pre></div>
</div>
</section>
<section id="kubectl-v1-16-7">
<h3><a class="reference external" href="https://github.com/kubernetes/kubectl/releases/tag/v0.16.7">Kubectl v1.16.7</a><a class="headerlink" href="#kubectl-v1-16-7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="p">|</span> sudo apt-key add - <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;deb https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span> <span class="p">|</span> sudo tee -a /etc/apt/sources.list.d/kubernetes.list

sudo apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo apt-get install -y <span class="nv">kubectl</span><span class="o">=</span><span class="m">1</span>.16.7-00 -V
</pre></div>
</div>
</section>
<section id="helm-v2-16-1">
<h3><a class="reference external" href="https://github.com/helm/helm/releases/tag/v2.16.1">Helm v2.16.1</a><a class="headerlink" href="#helm-v2-16-1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl -LO https://get.helm.sh/helm-v2.16.1-linux-amd64.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    tar xzvf helm-v2.16.1-linux-amd64.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo mv linux-amd64/tiller linux-amd64/helm /usr/local/bin/ <span class="o">&amp;&amp;</span> <span class="se">\</span>
    rm -rf helm-v2.16.1-linux-amd64.tar.gz linux-amd64
</pre></div>
</div>
</section>
<section id="skaffold-v1-8-0">
<h3><a class="reference external" href="https://skaffold.dev/">Skaffold v1.8.0</a><a class="headerlink" href="#skaffold-v1-8-0" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/v1.8.0/skaffold-linux-amd64 <span class="o">&amp;&amp;</span> <span class="se">\</span>
    chmod +x skaffold <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo mv skaffold /usr/local/bin
</pre></div>
</div>
</section>
<section id="k9s-v0-22-0">
<h3><a class="reference external" href="https://github.com/derailed/k9s">k9s v0.22.0</a><a class="headerlink" href="#k9s-v0-22-0" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Note: this one is not mandatory but it is such a great k8s tool that I couldn’t resist to add it!</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mkdir k9s <span class="o">&amp;&amp;</span> <span class="nb">cd</span> k9s <span class="o">&amp;&amp;</span> <span class="se">\</span>
    curl -L0 https://github.com/derailed/k9s/releases/download/v0.22.0/k9s_Linux_x86_64.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    tar xzvf k9s_Linux_x86_64.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo mv k9s /usr/local/bin <span class="o">&amp;&amp;</span> <span class="se">\</span>
    rm -rf k9s
</pre></div>
</div>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<section id="minikube-config">
<h3>Minikube config<a class="headerlink" href="#minikube-config" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo minikube start --vm-driver<span class="o">=</span>none --kubernetes-version<span class="o">=</span><span class="s1">&#39;v1.16.7&#39;</span>
</pre></div>
</div>
<p>In case of <code class="docutils literal notranslate"><span class="pre">HOST_JUJU_LOCK_PERMISSION</span></code> error, please update as follow:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo sysctl fs.protected_regular<span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>Enable addons</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check minikube status</span>
sudo minikube status

<span class="c1"># Check the enabled addons</span>
sudo minikube addons list

<span class="c1"># You&#39;ll need at least ingress &amp; helm-tiller addons activated</span>
sudo minikube addons <span class="nb">enable</span> ingress <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo minikube addons <span class="nb">enable</span> ingress-dns <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo minikube addons <span class="nb">enable</span> helm-tiller
</pre></div>
</div>
</section>
<section id="helm-init">
<h3>Helm init<a class="headerlink" href="#helm-init" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo helm init <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo kubectl get pods --namespace kube-system <span class="p">|</span> grep tiller
</pre></div>
</div>
</section>
<section id="add-bitnami-repo-to-helm-repos">
<h3>Add bitnami repo to Helm repos<a class="headerlink" href="#add-bitnami-repo-to-helm-repos" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo helm repo add bitnami https://charts.bitnami.com/bitnami
</pre></div>
</div>
</section>
</section>
<section id="network-quick-config">
<h2>Network quick config<a class="headerlink" href="#network-quick-config" title="Permalink to this headline">¶</a></h2>
<section id="on-the-server">
<h3>On the server<a class="headerlink" href="#on-the-server" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>sudo minikube ip<span class="k">)</span><span class="s2"> substra-backend.node-1.com substra-frontend.node-1.com substra-backend.node-2.com substra-frontend.node-2.com&quot;</span> <span class="p">|</span> sudo tee -a /etc/hosts
</pre></div>
</div>
</section>
<section id="on-your-local-machine-mac-linux">
<h3>On your local machine (Mac &amp; Linux)<a class="headerlink" href="#on-your-local-machine-mac-linux" title="Permalink to this headline">¶</a></h3>
<p>Set the server external ip in the <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> file.</p>
<blockquote>
<div><p>Please replace <code class="docutils literal notranslate"><span class="pre">&lt;SERVER-EXTERNAL-IP&gt;</span></code> with the external ip of your server.</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;&lt;SERVER-EXTERNAL-IP&gt; substra-backend.node-1.com substra-frontend.node-1.com substra-backend.node-2.com substra-frontend.node-2.com&quot;</span> <span class="p">|</span> sudo tee -a /etc/hosts
</pre></div>
</div>
</section>
</section>
<section id="clone-the-repositories-and-switch-to-the-correct-version">
<h2>Clone the repositories and switch to the correct version<a class="headerlink" href="#clone-the-repositories-and-switch-to-the-correct-version" title="Permalink to this headline">¶</a></h2>
<p>Please refer to the <a class="reference external" href="https://github.com/SubstraFoundation/substra#compatibility-table">compatibility table</a>.</p>
<blockquote>
<div><p>Note: this is a setup compatible with substra v0.6.0</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mkdir substra <span class="o">&amp;&amp;</span> <span class="nb">cd</span> substra
git clone https://github.com/SubstraFoundation/substra.git --branch <span class="m">0</span>.6.0
git clone https://github.com/SubstraFoundation/hlf-k8s.git --branch <span class="m">0</span>.0.12 <span class="c1"># or checkout fe33fc0 ¯\_(ツ)_/¯</span>
git clone https://github.com/SubstraFoundation/substra-frontend.git --branch <span class="m">0</span>.0.17
git clone https://github.com/SubstraFoundation/substra-backend.git --branch <span class="m">0</span>.0.19
</pre></div>
</div>
</section>
<section id="fire-up">
<h2>Fire up<a class="headerlink" href="#fire-up" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Note: In hlf-k8s repository, you will need to update the <code class="docutils literal notranslate"><span class="pre">skaffold.yaml</span></code> file and edit the <code class="docutils literal notranslate"><span class="pre">chaincodes[0].src</span></code> variable for each organisation.
You will have to use the correct chaincode version according to the <a class="reference external" href="https://github.com/SubstraFoundation/substra#compatibility-table">compatibility table</a>, for example, with substra v0.6.0:
<code class="docutils literal notranslate"><span class="pre">chaincodes[0].src:</span> <span class="pre">https://github.com/SubstraFoundation/substra-chaincode/archive/0.0.10.tar.gz</span></code></p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># start hlf-k8s</span>
<span class="nb">cd</span> hlf-k8s <span class="o">&amp;&amp;</span> sudo skaffold run

<span class="c1"># start the backend</span>
<span class="nb">cd</span> ../substra-backend <span class="o">&amp;&amp;</span> sudo skaffold run

<span class="c1"># start the frontend</span>
<span class="nb">cd</span> ../substra-frontend <span class="o">&amp;&amp;</span> sudo skaffold run

<span class="c1"># Quick test on backend node-1</span>
<span class="c1"># From the server &amp; from your local machine:</span>
curl substra-backend.node-1.com/readiness
<span class="c1"># should return &quot;OK&quot;</span>
</pre></div>
</div>
<p>If you didn’t see <code class="docutils literal notranslate"><span class="pre">OK</span></code>:</p>
<ul class="simple">
<li><p>Check that your <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> file is using the correct ip and that domains are registered</p></li>
<li><p>Use <a class="reference external" href="https://github.com/derailed/k9s">k9s</a></p></li>
<li><p>Check the <a class="reference external" href="https://doc.substra.ai/setup/further_resources.html">troubleshooting section</a></p></li>
<li><p>We also have a <a class="reference external" href="https://substra-workspace.slack.com/archives/CT54J1U2E">#help</a> channel on Slack</p></li>
</ul>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="further_resources.html" class="btn btn-neutral float-right" title="Further resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="local_install_skaffold.html" class="btn btn-neutral float-left" title="Local installation of Substra using Kubernetes and Skaffold" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Substra Foundation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>