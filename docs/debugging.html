

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Local Debug &mdash; Substra 1.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Server setup" href="setup/index.html" />
    <link rel="prev" title="Client" href="usage.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Substra
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
</ul>
<p><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usage.html">Client</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Local Debug</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-your-code-locally">Run your code locally</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#use-assets-from-a-deployed-substra-platform-and-local-assets">Use assets from a deployed Substra platform and local assets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependency-between-assets">Dependency between assets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-with-logs-and-breakpoints">Debugging with logs and breakpoints</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#access-the-logs">Access the logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debug-with-pdb">Debug with pdb</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setup/index.html">Server setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo.html">Demo</a></li>
</ul>
<p><span class="caption-text">Platform description</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
</ul>
<p><span class="caption-text">Specific entry points</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p><span class="caption-text">Contribute</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing to Substra</a></li>
<li class="toctree-l1"><a class="reference internal" href="publish.html">Build &amp; publish the documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Substra</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Local Debug</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="local-debug">
<h1>Local Debug<a class="headerlink" href="#local-debug" title="Permalink to this headline">¶</a></h1>
<p>For a complete example, see the <a class="reference external" href="https://github.com/SubstraFoundation/substra/tree/master/examples/debugging">debugging example</a>.</p>
<ul class="simple">
<li><p><a class="reference external" href="#dependencies">Dependencies</a></p></li>
<li><p><a class="reference external" href="#run-your-code-locally">Run your code locally</a></p>
<ul>
<li><p><a class="reference external" href="#use-assets-from-a-deployed-substra-platform-and-local-assets">Use assets from a deployed Substra platform and local assets</a></p></li>
<li><p><a class="reference external" href="#dependency-between-assets">Dependency between assets</a></p></li>
<li><p><a class="reference external" href="#debugging-with-logs-and-breakpoints">Debugging with logs and breakpoints</a></p>
<ul>
<li><p><a class="reference external" href="#access-the-logs">Access the logs</a></p></li>
<li><p><a class="reference external" href="#debug-with-pdb">Debug with pdb</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Substra must be installed.</p></li>
<li><p>Docker is required since the training and testing tasks are run in Docker containers:</p>
<ul>
<li><p>Mac: <a class="reference external" href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></p></li>
<li><p>Ubuntu/Debian: <a class="reference external" href="https://docs.docker.com/engine/install/ubuntu/">installation instructions</a></p></li>
</ul>
</li>
</ul>
<p>If you want to debug your script using assets from the Substra platform, you also need access to the platform the assets are on.</p>
</section>
<section id="run-your-code-locally">
<h2>Run your code locally<a class="headerlink" href="#run-your-code-locally" title="Permalink to this headline">¶</a></h2>
<p>With this installation, you can write scripts using the <a class="reference external" href="https://github.com/SubstraFoundation/substra/blob/master/references/sdk.md#substrasdk">SDK</a> as you would for a remote execution, then
set the <code class="docutils literal notranslate"><span class="pre">debug</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> when creating the client.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">substra</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">from_config_file</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="s2">&quot;node-1&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Contrary to the default execution, the execution is done synchronously, so the script waits for the task in progress to end before continuing.<br />The execution of the tuples happens in Docker containers that are spawned on the fly and removed once the execution is done.</p>
<section id="use-assets-from-a-deployed-substra-platform-and-local-assets">
<h3>Use assets from a deployed Substra platform and local assets<a class="headerlink" href="#use-assets-from-a-deployed-substra-platform-and-local-assets" title="Permalink to this headline">¶</a></h3>
<p>With this, you gain access to the platform in ‘read-only’ mode and any asset you create is created locally.</p>
<p>This means that any function to get, describe or download an asset works with assets from the platform and local assets. Functions to
list assets will list the assets from the platform and the local ones.<br />Functions that create a new asset (they start with <code class="docutils literal notranslate"><span class="pre">add</span></code>) only create local assets.<br />To differentiate between a local asset and a remote one, look at their key: for local assets, it starts with <code class="docutils literal notranslate"><span class="pre">local_</span></code>.</p>
<p>Local assets are saved in-memory, they have the same lifetime as the Client object (deleted at the end of the script).</p>
</section>
<section id="dependency-between-assets">
<h3>Dependency between assets<a class="headerlink" href="#dependency-between-assets" title="Permalink to this headline">¶</a></h3>
<p>Any asset created locally can depend on an asset from the platform or on another local asset:</p>
<ul class="simple">
<li><p>a traintuple can use an algo and dataset from the platform</p></li>
<li><p>a testtuple can use an objective from the platform</p></li>
<li><p>etc.</p></li>
</ul>
<p>There is one exception: a traintuple, testtuple or any other tuple created locally cannot depend on a tuple from the platform
or from a compute plan defined on the platform. This is impossible because it is forbidden to download models from the platform.</p>
<p>Since no data can leave the platform, a task depending on a dataset from the platform uses the fake data generated from the opener. The
number of fake samples generated is equal to the number of samples the task would have used.</p>
</section>
<section id="debugging-with-logs-and-breakpoints">
<h3>Debugging with logs and breakpoints<a class="headerlink" href="#debugging-with-logs-and-breakpoints" title="Permalink to this headline">¶</a></h3>
<section id="access-the-logs">
<h4>Access the logs<a class="headerlink" href="#access-the-logs" title="Permalink to this headline">¶</a></h4>
<p>In debug mode, the logs of the execution of the traintuples and testtuples are saved
in the <code class="docutils literal notranslate"><span class="pre">log</span></code> field.</p>
<p>To display them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">traintuple</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_traintuple</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">traintuple</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Moreover, if there is an error in the execution, those logs are displayed in the call stack.<br />So any <code class="docutils literal notranslate"><span class="pre">print</span></code> or warning in the algo file for example will be displayed.</p>
</section>
<section id="debug-with-pdb">
<h4>Debug with pdb<a class="headerlink" href="#debug-with-pdb" title="Permalink to this headline">¶</a></h4>
<p>As said above, the tuples are executed in Docker containers spawned on the fly and deleted at the end of the execution.<br />If you want access to the container while it runs, you can use <a class="reference external" href="https://docs.python.org/3.6/library/pdb.html#pdb.set_trace"><code class="docutils literal notranslate"><span class="pre">pdb</span></code></a> to pause the execution
until you connect to the container.</p>
<p>For example, I want to debug an algo. In the <code class="docutils literal notranslate"><span class="pre">algo.py</span></code> file, in the train function, I put a breakpoint with pdb:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pdb</span>

<span class="k">class</span> <span class="nc">Algo</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">Algo</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</pre></div>
</div>
<p>I add the algo and a traintuple that depends on it to the client in debug mode. When I add the traintuple to the client, it is immediately executed
and pauses on the pdb breakpoint.</p>
<p>For this, I need the algo key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">algo_key</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_algo</span><span class="p">(</span><span class="o">...</span><span class="p">)[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">algo_key</span><span class="p">)</span>
</pre></div>
</div>
<p>Then I open a new terminal and list the running Docker containers:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker ps -a <span class="p">|</span> grep algo-<span class="o">{</span>algo_key<span class="o">}</span>
</pre></div>
</div>
<p>where {algo_key} is the key of the algo in Substra. This gives me the ID of the
container (first column).</p>
<p>I attach to the container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker attach <span class="o">{</span>container_id<span class="o">}</span>
</pre></div>
</div>
<p>and can now use <code class="docutils literal notranslate"><span class="pre">pdb</span></code> commands.</p>
</section>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="setup/index.html" class="btn btn-neutral float-right" title="Server setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="usage.html" class="btn btn-neutral float-left" title="Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Substra Foundation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>